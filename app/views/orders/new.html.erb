<!-- app/views/orders/new.html.erb -->
<h1>Checkout</h1>

<% if session[:cart].blank? %>
  <p>Your cart is empty.</p>
<% else %>
  <!-- Display Cart Items -->
  <h2>Your Cart Items</h2>
  <table>
    <% total_price = 0 %>
    <% session[:cart].each do |item| %>
      <% product = Product.find(item["product_id"]) %>
      <tr>
        <td><%= product.name %></td>
        <td><%= item["quantity"] %> x <%= number_to_currency(product.price) %></td>
        <% total_price += product.price * item["quantity"] %>
      </tr>
    <% end %>
    <tr>
      <td><strong>Total Price:</strong></td>
      <td><%= number_to_currency(total_price) %></td>
    </tr>
  </table>

  <!-- Checkout Form -->
  <%= form_with(url: orders_path, method: :post) do |form| %>
    <!-- Shipping Information -->
    <h3>Shipping Information</h3>
    <%= form.text_field :name, placeholder: "Full Name" %>
    <%= form.text_field :address, placeholder: "Address" %>
    <%= form.text_field :city, placeholder: "City" %>
    <%= form.collection_select :province_id, Province.all, :id, :name, include_blank: true, id: "province_selector" %>
    <%= form.text_field :postal_code, placeholder: "Postal Code" %>

    <!-- Payment Information (Placeholder) -->
    <h3>Payment Information</h3>
    <%= form.text_field :card_number, placeholder: "Credit Card Number" %>
    <%= form.text_field :card_expiry, placeholder: "MM/YY" %>
    <%= form.text_field :card_cvv, placeholder: "CVV" %>

    <!-- Display tax by province -->
    <div id="taxes">
      <p>GST: <%= number_to_currency(@gst) %></p>
      <p>PST: <%= number_to_currency(@pst) %></p>
      <p>HST: <%= number_to_currency(@hst) %></p>
      <p>Total Cost: <%= number_to_currency(@total_price) %></p>
    </div>

    <!-- Submit Button -->
    <%= form.submit "Complete Order", class: "button is-primary" %>
  <% end %>
<% end %>
